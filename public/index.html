<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sydney Tennis Court Finder</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(135deg, rgba(34, 139, 34, 0.08) 0%, rgba(46, 125, 50, 0.05) 100%),
                  repeating-linear-gradient(90deg, transparent, transparent 49px, rgba(34, 139, 34, 0.06) 49px, rgba(34, 139, 34, 0.06) 51px, transparent 51px),
                  repeating-linear-gradient(0deg, transparent, transparent 49px, rgba(34, 139, 34, 0.06) 49px, rgba(34, 139, 34, 0.06) 51px, transparent 51px),
                  linear-gradient(to bottom, #fafafa 0%, #f5f5f5 100%);
      min-height: 100vh;
      padding-top: 0; /* No padding - ad scrolls away naturally */
      padding-bottom: 120px; /* Space for fixed bottom ad */
    }
    
    /* Sticky Header */
    .sticky-header {
      position: sticky; /* Use sticky instead of fixed - sticks after scrolling past ad */
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 100%);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      transition: all 0.3s ease;
    }
    
    /* Compact header when scrolling */
    .sticky-header.scrolled {
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    
    .theme-green { background: linear-gradient(135deg, #2e7d32 0%, #43a047 100%); }
    .theme-blue { background: linear-gradient(135deg, #1976d2 0%, #2196f3 100%); }
    .theme-purple { background: linear-gradient(135deg, #7b1fa2 0%, #9c27b0 100%); }
    .theme-orange { background: linear-gradient(135deg, #e65100 0%, #f57c00 100%); }
    .theme-teal { background: linear-gradient(135deg, #00695c 0%, #00897b 100%); }
    .theme-indigo { background: linear-gradient(135deg, #303f9f 0%, #3949ab 100%); }
    .theme-pink { background: linear-gradient(135deg, #c2185b 0%, #d81b60 100%); }
    .theme-cyan { background: linear-gradient(135deg, #0097a7 0%, #00acc1 100%); }
    
    .court-grid {
      display: grid;
      gap: 0.5rem;
      max-width: 100%;
    }
    
    /* Dynamic column sizing based on number of courts */
    /* Few courts (1-4): wider columns for better visibility */
    .court-grid[data-court-count="1"],
    .court-grid[data-court-count="2"],
    .court-grid[data-court-count="3"],
    .court-grid[data-court-count="4"] {
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    }
    
    /* Medium courts (5-7): medium width */
    .court-grid[data-court-count="5"],
    .court-grid[data-court-count="6"],
    .court-grid[data-court-count="7"] {
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    }
    
    /* Many courts (8+): use auto-fit to fill screen space properly */
    .court-grid[data-court-count="8"],
    .court-grid[data-court-count="9"],
    .court-grid[data-court-count="10"],
    .court-grid[data-court-count="11"],
    .court-grid[data-court-count="12"] {
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    }
    
    /* Extra large courts (13+): more compact */
    .court-grid:not([data-court-count="1"]):not([data-court-count="2"]):not([data-court-count="3"]):not([data-court-count="4"]):not([data-court-count="5"]):not([data-court-count="6"]):not([data-court-count="7"]):not([data-court-count="8"]):not([data-court-count="9"]):not([data-court-count="10"]):not([data-court-count="11"]):not([data-court-count="12"]) {
      grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
    }
    
    @media (min-width: 640px) {
      .court-grid[data-court-count="1"],
      .court-grid[data-court-count="2"],
      .court-grid[data-court-count="3"],
      .court-grid[data-court-count="4"] {
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      }
      
      .court-grid[data-court-count="5"],
      .court-grid[data-court-count="6"],
      .court-grid[data-court-count="7"] {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      }
      
      .court-grid[data-court-count="8"],
      .court-grid[data-court-count="9"],
      .court-grid[data-court-count="10"],
      .court-grid[data-court-count="11"],
      .court-grid[data-court-count="12"] {
        grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      }
    }
    
    @media (min-width: 1024px) {
      .court-grid[data-court-count="1"],
      .court-grid[data-court-count="2"],
      .court-grid[data-court-count="3"],
      .court-grid[data-court-count="4"] {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      }
      
      .court-grid[data-court-count="5"],
      .court-grid[data-court-count="6"],
      .court-grid[data-court-count="7"] {
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      }
      
      .court-grid[data-court-count="8"],
      .court-grid[data-court-count="9"],
      .court-grid[data-court-count="10"],
      .court-grid[data-court-count="11"],
      .court-grid[data-court-count="12"] {
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      }
    }
    
    .time-slot {
      font-size: 0.9rem;
      font-weight: 600;
      padding: 0.5rem 0.4rem;
      line-height: 1.3;
      min-height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .racquet-animation {
      animation: swing 1.5s ease-in-out infinite;
    }
    
    @keyframes swing {
      0%, 100% { transform: rotate(-10deg); }
      50% { transform: rotate(10deg); }
    }
    
    .ad-space {
      background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
      border: 2px dashed #bdbdbd;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #757575;
      font-weight: 600;
      min-height: 100px;
    }
    
    .bottom-ad {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 50;
      box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .header-compact {
      background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 100%);
    }
    
    .slot-count-badge {
      animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }

    .region-badge {
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      border-radius: 0.375rem;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(4px);
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { createRoot } = ReactDOM;

    const Icon = ({ name, className = '' }) => {
      const icons = {
        search: () => (
          <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
        ),
        location: () => (
          <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
        ),
        phone: () => (
          <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
          </svg>
        ),
        calendar: () => (
          <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
        ),
        globe: () => (
          <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
          </svg>
        ),
      };
      return icons[name] ? icons[name]() : null;
    };

    function organizeSlotsByCourt(slots) {
      const byCourt = {};
      
      slots.forEach(slot => {
        const court = slot.court || 'Court 1';
        if (!byCourt[court]) {
          byCourt[court] = [];
        }
        byCourt[court].push(slot);
      });
      
      // Sort courts naturally (Court 1, Court 2, etc.)
      const courts = Object.keys(byCourt).sort((a, b) => {
        const numA = parseInt(a.match(/\d+/)?.[0] || '0');
        const numB = parseInt(b.match(/\d+/)?.[0] || '0');
        return numA - numB;
      });
      
      // Sort times within each court
      courts.forEach(court => {
        byCourt[court].sort((a, b) => {
          const [aHour, aMin] = a.time.split(':').map(Number);
          const [bHour, bMin] = b.time.split(':').map(Number);
          return aHour * 60 + aMin - (bHour * 60 + bMin);
        });
      });
      
      return { byCourt, courts };
    }

    function App() {
      const [selectedDate, setSelectedDate] = useState(() => {
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        return tomorrow.toISOString().split('T')[0];
      });
      const [selectedRegion, setSelectedRegion] = useState('All Regions');
      const [availableRegions, setAvailableRegions] = useState(['All Regions']);
      const [loading, setLoading] = useState(false);
      const [results, setResults] = useState(null);
      const [error, setError] = useState(null);
      const [isScrolled, setIsScrolled] = useState(false);

      const colorThemes = ['theme-green', 'theme-blue', 'theme-purple', 'theme-orange', 
                          'theme-teal', 'theme-indigo', 'theme-pink', 'theme-cyan'];

      useEffect(() => {
        fetch('/api/regions')
          .then(res => res.json())
          .then(data => {
            setAvailableRegions(['All Regions', ...data.regions]);
          })
          .catch(err => console.error('Failed to load regions:', err));
        
        // Add scroll listener for header shadow effect
        const handleScroll = () => {
          setIsScrolled(window.scrollY > 50);
        };
        
        window.addEventListener('scroll', handleScroll);
        return () => window.removeEventListener('scroll', handleScroll);
      }, []);

      const handleSearch = async () => {
        setLoading(true);
        setError(null);
        setResults(null);

        try {
          const params = new URLSearchParams({
            date: selectedDate,
            region: selectedRegion
          });

          const response = await fetch(`/api/search?${params}`);
          const data = await response.json();

          if (data.error) {
            setError(data.error);
          } else {
            setResults(data);
          }
        } catch (err) {
          setError('Failed to connect to server');
        } finally {
          setLoading(false);
        }
      };

      return React.createElement('div', { className: 'min-h-screen' },
        // TOP AD SPACE (STATIC - scrolls away)
        React.createElement('div', { className: 'ad-space mb-0' },
          'ðŸ“¢ Advertisement Space - 728x90 Banner'
        ),

        // STICKY HEADER (Search controls stay visible)
        React.createElement('div', { 
          className: `sticky-header text-white py-4 ${isScrolled ? 'scrolled' : ''}`
        },
          React.createElement('div', { className: 'container mx-auto max-w-7xl px-4' },
            React.createElement('div', { className: 'flex items-center justify-center gap-3 mb-4' },
              React.createElement('span', { className: 'text-4xl' }, 'ðŸŽ¾'),
              React.createElement('h1', { className: 'text-3xl font-bold' }, 'Sydney Tennis Court Finder')
            ),
            React.createElement('div', { className: 'flex flex-col sm:flex-row gap-3 max-w-3xl mx-auto' },
              // Date Input
              React.createElement('div', { className: 'flex-1' },
                React.createElement('input', {
                  type: 'date',
                  value: selectedDate,
                  onChange: (e) => setSelectedDate(e.target.value),
                  className: 'w-full px-4 py-2 rounded-lg bg-white/20 backdrop-blur text-white placeholder-white/70 border-2 border-white/30 focus:border-white/50 focus:outline-none text-sm'
                })
              ),
              // Region Selector
              React.createElement('select', {
                value: selectedRegion,
                onChange: (e) => setSelectedRegion(e.target.value),
                className: 'flex-1 px-4 py-2 rounded-lg bg-white/20 backdrop-blur text-white border-2 border-white/30 focus:border-white/50 focus:outline-none text-sm'
              },
                availableRegions.map(region => 
                  React.createElement('option', { 
                    key: region, 
                    value: region,
                    className: 'bg-gray-800'
                  }, region)
                )
              ),
              // Search Button
              React.createElement('button', {
                onClick: handleSearch,
                disabled: loading,
                className: 'bg-white/20 hover:bg-white/30 text-white font-bold py-2 px-6 rounded-lg flex items-center justify-center gap-2 transition-all disabled:opacity-50 backdrop-blur text-sm'
              },
                React.createElement(Icon, { name: 'search', className: 'w-4 h-4' }),
                loading ? 'Searching...' : 'Find Courts'
              )
            )
          )
        ),

        // MAIN CONTENT
        React.createElement('div', { className: 'container mx-auto max-w-7xl px-4 py-6' },
          loading && React.createElement('div', { className: 'text-center py-12 bg-white/80 backdrop-blur rounded-2xl shadow-lg' },
            React.createElement('div', { className: 'text-6xl mb-4 racquet-animation inline-block' }, 'ðŸŽ¾'),
            React.createElement('p', { className: 'text-xl text-gray-700 font-bold mb-2' }, 'Finding courts for you...'),
            React.createElement('p', { className: 'text-base text-green-600 font-semibold' }, 
              selectedRegion === 'All Regions' 
                ? 'Searching all Sydney regions - This might take a minute!' 
                : `Searching ${selectedRegion} - Takes about 30 seconds!`
            )
          ),

          error && React.createElement('div', { className: 'bg-red-50 border-2 border-red-300 text-red-800 px-4 py-3 rounded-lg text-center shadow-lg' },
            React.createElement('p', { className: 'font-bold' }, 'âŒ Error'),
            React.createElement('p', null, error)
          ),

          results && React.createElement('div', null,
            // COMPACT STATS WITH REGION INFO
            React.createElement('div', { className: 'mb-4 p-4 bg-white/90 backdrop-blur rounded-lg shadow-md border border-gray-200' },
              React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-5 gap-3 text-center' },
                React.createElement('div', null,
                  React.createElement('div', { className: 'text-3xl font-bold text-green-600' }, results.totalAvailableSlots),
                  React.createElement('div', { className: 'text-xs text-gray-600 mt-1 font-medium' }, 'Courts')
                ),
                React.createElement('div', null,
                  React.createElement('div', { className: 'text-3xl font-bold text-blue-600' }, 
                    results.clubs.filter(c => c.success).length, '/', results.totalClubs
                  ),
                  React.createElement('div', { className: 'text-xs text-gray-600 mt-1 font-medium' }, 'Checked')
                ),
                React.createElement('div', null,
                  React.createElement('div', { className: 'text-3xl font-bold text-purple-600' }, results.scrapeDuration || 'N/A'),
                  React.createElement('div', { className: 'text-xs text-gray-600 mt-1 font-medium' }, 'Time')
                ),
                React.createElement('div', null,
                  React.createElement('div', { className: 'text-3xl font-bold text-orange-600' }, 
                    new Date(selectedDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })
                  ),
                  React.createElement('div', { className: 'text-xs text-gray-600 mt-1 font-medium' }, 'Date')
                ),
                React.createElement('div', null,
                  React.createElement('div', { className: 'text-2xl font-bold text-teal-600' }, 
                    selectedRegion === 'All Regions' ? 'ðŸŒ' : 'ðŸ“'
                  ),
                  React.createElement('div', { className: 'text-xs text-gray-600 mt-1 font-medium' }, 
                    selectedRegion === 'All Regions' ? 'All Regions' : selectedRegion
                  )
                )
              )
            ),

            // CLUBS WITH ROTATING COLORS AND REGION BADGES
            results.clubs.filter(club => club.availableSlots.length > 0).map((club, clubIndex) => {
              const themeClass = colorThemes[clubIndex % colorThemes.length];
              
              return React.createElement('div', { 
                key: club.club,
                className: 'mb-4 bg-white/90 backdrop-blur rounded-xl shadow-lg overflow-hidden border border-gray-200'
              },
                React.createElement('div', { className: `${themeClass} p-3` },
                  React.createElement('div', { className: 'flex items-center justify-between flex-wrap gap-2' },
                    React.createElement('div', { className: 'flex-1 min-w-0' },
                      React.createElement('div', { className: 'flex items-center gap-2 flex-wrap' },
                        React.createElement('h3', { className: 'text-xl font-bold text-white truncate' }, club.club),
                        club.region && React.createElement('span', { className: 'region-badge text-white' }, 
                          club.region
                        )
                      ),
                      React.createElement('div', { className: 'text-white/90 text-xs mt-1' },
                        React.createElement('div', { className: 'flex items-center gap-1' },
                          React.createElement(Icon, { name: 'location', className: 'w-3 h-3 flex-shrink-0' }),
                          React.createElement('span', { className: 'truncate' }, club.address)
                        )
                      )
                    ),
                    React.createElement('div', { className: 'flex items-center gap-2' },
                      React.createElement('button', {
                        onClick: () => window.open(club.website, '_blank'),
                        className: 'bg-white/20 hover:bg-white/30 text-white px-3 py-1.5 rounded-lg flex items-center gap-1.5 text-xs font-medium transition-all'
                      },
                        React.createElement(Icon, { name: 'globe', className: 'w-3.5 h-3.5' }),
                        'Book'
                      ),
                      React.createElement('div', { className: 'bg-white/20 backdrop-blur rounded-lg px-3 py-1.5 text-center slot-count-badge' },
                        React.createElement('div', { className: 'text-2xl font-bold text-white' }, club.availableSlots.length),
                        React.createElement('div', { className: 'text-[10px] text-white/90 leading-tight' }, 'slots')
                      )
                    )
                  )
                ),
                React.createElement('div', { className: 'p-3' },
                  (() => {
                    const { byCourt, courts } = organizeSlotsByCourt(club.availableSlots);
                    
                    return React.createElement('div', { 
                      className: 'court-grid',
                      'data-court-count': courts.length.toString()
                    },
                      courts.map(court => 
                        React.createElement('div', { 
                          key: court,
                          className: 'flex flex-col min-h-0'
                        },
                          React.createElement('div', { className: `${themeClass} text-white font-semibold text-center py-1.5 px-2 rounded-t-lg text-sm leading-tight` },
                            court
                          ),
                          React.createElement('div', { className: 'space-y-1.5 bg-gray-50 p-2 rounded-b-lg border-2 border-gray-200 border-t-0 flex-grow overflow-hidden' },
                            byCourt[court].map((slot, idx) =>
                              React.createElement('button', {
                                key: idx,
                                onClick: () => window.open(slot.bookingUrl || club.website, '_blank'),
                                className: 'time-slot w-full bg-white hover:bg-green-50 border border-gray-300 hover:border-green-500 rounded text-center transition-all text-gray-800 shadow-sm hover:shadow-md text-xs',
                                title: slot.bookingUrl ? 'Click to book this specific time slot' : 'Click to view booking page'
                              },
                                slot.timeDisplay || slot.time
                              )
                            )
                          )
                        )
                      )
                    );
                  })()
                )
              );
            }),
            
            results.clubs.filter(club => club.availableSlots.length === 0).length > 0 &&
              React.createElement('div', { className: 'mt-4 p-3 bg-gray-100/80 backdrop-blur rounded-lg border border-gray-300 shadow text-center' },
                React.createElement('p', { className: 'text-gray-600 text-sm font-medium' },
                  'ðŸ“‹ ', results.clubs.filter(club => club.availableSlots.length === 0).length, 
                  ' club(s) with no availability'
                )
              )
          )
        ),

        // BOTTOM AD SPACE (STICKY)
        React.createElement('div', { className: 'bottom-ad ad-space bg-white' },
          'ðŸ“¢ Advertisement Space - 728x90 Bottom Banner (Sticky)'
        )
      );
    }

    const root = createRoot(document.getElementById('root'));
    root.render(React.createElement(App));
  </script>
</body>
</html>
